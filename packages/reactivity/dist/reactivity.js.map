{
  "version": 3,
  "sources": ["../../utils/src/index.ts", "../src/effect.ts", "../src/reactive.ts", "../src/ref.ts", "../src/computed.ts", "../src/index.ts"],
  "sourcesContent": ["// \u5B58\u653E\u90E8\u5206\u516C\u5171\u51FD\u6570\r\n\r\nexport function isObject(target: unknown): Boolean {\r\n    // \u5728JS\u4E2Dtypeof null\u4E5F\u662F\u8FD4\u56DEobject\uFF0C\u56E0\u6B64\u9700\u8981\u6392\u9664\r\n    return typeof target === 'object' && target !== null\r\n}\r\n\r\nexport function isArray(target: unknown): Boolean {\r\n    return Array.isArray(target)\r\n}\r\n\r\nexport function isFunction(target: unknown): Boolean {\r\n    return typeof target === 'function'\r\n}\r\n\r\nexport function isString(target: unknown): Boolean {\r\n    return typeof target === 'string'\r\n}\r\n\r\nexport function isNumber(target: unknown): Boolean {\r\n    return typeof target === 'number'\r\n}\r\n\r\nexport function isBoolean(target: unknown): Boolean {\r\n    return typeof target === 'boolean'\r\n}\r\n\r\n// \u9700\u8981\u6392\u9664NaN\u548CNaN\u4E0D\u5168\u7B49\u7684\u60C5\u51B5\r\nexport function hasChange(oldValue: unknown, newValue: unknown): Boolean {\r\n    return oldValue !== newValue && !(Number.isNaN(oldValue) && Number.isNaN(newValue))\r\n}\r\n\r\n", "import { EffectOptions,effectFn } from './types'\r\nlet activeEffect: Function | null; // \u4E00\u4E2A\u5168\u5C40\u4E34\u65F6\u53D8\u91CF\uFF0C\u7528\u6765\u5B58\u50A8\u5F53\u524D\u8C03\u7528\u7684\u526F\u4F5C\u7528\u51FD\u6570\u3002\u6BCF\u6B21\u8C03\u7528\u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u90FD\u4F1A\u628A\u81EA\u8EAB\u8D4B\u503C\u5230\u8FD9\u4E2A\u53D8\u91CF\uFF0C\u8FD9\u6837\u5728Proxy\u5BF9\u8C61\u7684get()\u65B9\u6CD5\u4E2D\u5C31\u53EF\u4EE5\u6839\u636E\u8FD9\u4E2A\u503C\u662F\u5426\u4E3A\u7A7A\uFF0C\u6765\u5224\u65AD\u662F\u4E0D\u662F\u7531\u526F\u4F5C\u7528\u51FD\u6570\u89E6\u53D1\u7684\u8BFB\u53D6\u884C\u4E3A\uFF0C\u8FDB\u800C\u51B3\u5B9A\u662F\u5426\u9700\u8981\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\u3002\r\nlet effectStack: Function[] = []; // \u5F53\u526F\u4F5C\u7528\u51FD\u6570\u91CC\u53C8\u5D4C\u5957\u4E86\u526F\u4F5C\u7528\u51FD\u6570\u65F6, \u6709\u53EF\u80FD\u51FA\u73B0\u91CC\u5C42\u7684\u526F\u4F5C\u7528\u51FD\u6570\u8D4B\u503C\u5230activeEffect\u5E76\u6267\u884C\u5B8C\u6BD5\u4EE5\u540E, \u6E05\u9664\u4E86activeEffect\u7684\u503C, \u5BFC\u81F4\u5916\u5C42\u51FD\u6570\u8BFB\u53D6Proxy\u503C\u65F6\u65E0\u6CD5\u88AB\u4F5C\u4E3A\u8BA2\u9605\u8005\u6536\u96C6\u7684\u60C5\u51B5, \u9700\u8981\u4E00\u4E2A\u6808\u5B58\u50A8\u6240\u6709\u7684\u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u901A\u8FC7\u5165\u6808\u4E0E\u51FA\u6808\u4FDD\u8BC1\u526F\u4F5C\u7528\u51FD\u6570\u4E0D\u4E22\u5931\r\n\r\n\r\n/**\r\n * effect\u63A5\u6536\u4E00\u4E2A\u51FD\u6570\u53C2\u6570\uFF0C\u6211\u4EEC\u79F0\u8FD9\u4E2A\u53C2\u6570\u4E3A\u526F\u4F5C\u7528\u51FD\u6570\u3002\r\n * \u526F\u4F5C\u7528\u51FD\u6570\u5728\u88AB\u4F20\u5165\u65F6\u4F1A\u7ACB\u5373\u6267\u884C\u4E00\u6B21\uFF0C\u5728\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\u4E2D\u5982\u679C\u8BFB\u53D6\u4E86\u67D0\u4E2AProxy\u5BF9\u8C61\u7684\u5C5E\u6027\u503C\uFF0C\u90A3\u4E48\u526F\u4F5C\u7528\u51FD\u6570\u81EA\u8EAB\u5C06\u88AB\u6536\u96C6\u5230\u8BE5\u5C5E\u6027\u7684\u8BA2\u9605\u8005\u6570\u7EC4\u4E2D\u3002\r\n * \u4E4B\u540E\u5728\u6BCF\u6B21\u8BE5\u5C5E\u6027\u503C\u6570\u636E\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u90FD\u4F1A\u91CD\u65B0\u6267\u884C\u5176\u4F9D\u8D56\u6570\u7EC4\u7684\u6240\u6709\u526F\u4F5C\u7528\u51FD\u6570\u3002\r\n */\r\nexport function effect(fn: Function, options: EffectOptions) {\r\n    /**\r\n     * \u5BF9\u4F20\u5165\u7684\u526F\u4F5C\u7528\u51FD\u6570\u8FDB\u884C\u4E00\u4E2A\u5C0F\u6539\u9020\uFF0C\u4F7F\u7528\u4E00\u4E2A\u8FD4\u56DE\u526F\u4F5C\u7528\u672C\u8EAB\u7684\u7BAD\u5934\u51FD\u6570\u8FDB\u884C\u5305\u88F9\r\n     * \u56E0\u4E3A\u8981\u8FFD\u52A0\u4E00\u4E2A\u903B\u8F91\uFF1A\u5728\u8C03\u7528\u526F\u4F5C\u7528\u51FD\u6570\u524D\uFF0C\u5148\u628A\u81EA\u5DF1\u6302\u5728\u5230activeEffect\u53D8\u91CF\u4E0A\uFF0C\u8FD9\u6837track\u51FD\u6570\u624D\u80FD\u628A\u526F\u4F5C\u7528\u51FD\u6570\u4F5C\u4E3A\u8BA2\u9605\u8005\u8FDB\u884C\u6536\u96C6\r\n     * \u4F46\u5FFD\u7565\u8FD9\u4E2A\u6846\u67B6\u5185\u90E8\u903B\u8F91\uFF0Ceffect\u672C\u8D28\u4E0A\u8FD8\u662F\u6267\u884C\u4F20\u5165\u7684\u526F\u4F5C\u7528\u51FD\u6570\u800C\u5DF2\r\n     *  */ \r\n    const effectFn = () => {\r\n        // \u4F7F\u7528try finally\u5305\u88F9\uFF0C\u4FDD\u8BC1\u65E0\u8BBA\u6267\u884C\u7ED3\u679C\u5982\u4F55\uFF0C\u6700\u540E\u90FD\u8981\u6E05\u7406\u6389\u5168\u5C40\u7684activeEffect\u53D8\u91CF\r\n        try {\r\n            activeEffect = effectFn;\r\n            // \u5148\u5165\u6808\u6682\u5B58, \u9632\u6B62\u91CC\u5C42\u6709\u526F\u4F5C\u7528\u51FD\u6570,finally\u628A\u5916\u5C42\u7684\u526F\u4F5C\u7528\u51FD\u6570\u6E05\u9664\u6389\r\n            effectStack.push(effectFn);\r\n            return fn()\r\n        }\r\n        finally {\r\n            // \u6267\u884C\u5B8C\u91CC\u5C42\u7684\u526F\u4F5C\u7528\u51FD\u6570\u65F6, \u628A\u81EA\u5DF1\u51FA\u6808, \u7136\u540E\u62FF\u56DE\u5916\u5C42\u7684\u526F\u4F5C\u7528\u51FD\u6570\u51FA\u6765,\u91CD\u65B0\u8D4B\u503C\u5230activeEffect\u53BB\r\n            effectStack.pop();\r\n            activeEffect = effectStack[effectStack.length - 1] ?? null\r\n        }\r\n    }\r\n    // \u6B63\u5E38\u60C5\u51B5\u4E0B\u526F\u4F5C\u7528\u51FD\u6570\u4F1A\u7ACB\u5373\u6267\u884C\u4E00\u6B21\uFF0C\u4F46\u9884\u7559\u4E00\u4E2AOptions\u5BF9\u8C61\uFF0C\u5982\u679Coptions.lazy\u5C5E\u6027\u4E3Atrue\uFF0C\u90A3\u9996\u6B21\u4E0D\u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570\r\n    !options.lazy && effectFn()\r\n    // \u5982\u679C\u4F20\u5165\u4E86\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\uFF0C\u90A3\u5C31\u6302\u5728\u5230effectFn\u4E0B\uFF0Ctrigger\u6267\u884C\u65F6\u4F1A\u68C0\u6D4B\u662F\u5426\u6709\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\r\n    options.scheduler && (effectFn.scheduler = options.scheduler)\r\n    return effectFn;\r\n}\r\n\r\n/**\r\n * \u521B\u5EFA\u4E00\u4E2AWeakMap\u5BF9\u8C61\uFF0C\u7528\u6765\u5B58\u653E\u6BCF\u4E2A\u5C5E\u6027\u503C\u7684\u8BA2\u9605\u8005\u6570\u7EC4\u3002\r\n * \uFF08WeakMap\u53EA\u80FD\u63A5\u53D7Object\u4F5C\u4E3Akey\uFF0C\u5982\u679C\u8FD9\u4E2Akey\u53D8\u6210\u4E86null\uFF0C\u4F1A\u88AB\u81EA\u52A8\u4ECEWeakMap\u4E2D\u6E05\u9664\u6389\uFF0C\u9632\u6B62\u5185\u5B58\u6EA2\u51FA\uFF09\r\n * \u6570\u636E\u7ED3\u6784\u4E3A: {\r\n *     Proxy\u5BF9\u8C61: {\r\n *          Proxy\u5BF9\u8C61\u7684\u5C5E\u6027\u503C: [\u8C03\u7528\u6B64\u5C5E\u6027\u503C\u7684effect\u65B9\u6CD5]\r\n *      }\r\n * }\r\n * \u8FD9\u6837\u5B50\uFF0C\u6BCF\u6B21\u8C03\u7528Proxy\u5BF9\u8C61\u7684\u67D0\u4E2A\u5C5E\u6027\u65F6\uFF0C\u5C31\u628A\u91CC\u9762\u5B58\u50A8\u526F\u4F5C\u7528\u51FD\u6570\u7684Set\u6570\u7EC4\u62FF\u51FA\u6765\u904D\u5386\u4E00\u6B21\u8C03\u7528\u5373\u53EF\u3002\r\n */\r\nconst proxyObjectRecordMap = new WeakMap();\r\n\r\n/**\r\n * \u8DDF\u8E2A\u5668\uFF1A\u6536\u96C6\u4F9D\u8D56\u8BA2\u9605\u67D0\u4E2A\u5C5E\u6027\u7684\u526F\u4F5C\u7528\u7684\u65B9\u6CD5\u3002\u8DDF\u8E2A\u5668\u4F1A\u5728handler\u7684get()\u65B9\u6CD5\u4E2D\u88AB\u8C03\u7528\u3002\r\n */\r\nexport function track(target: Object, key: String | Symbol) {\r\n    /**\r\n     * Proxy\u5BF9\u8C61\u7684\u5C5E\u6027\u88AB\u8BFB\u53D6\u65F6\uFF0C\u8981\u5224\u65AD\u662F\u4E0D\u662F\u88AB\u526F\u4F5C\u7528\u51FD\u6570\u6240\u8BFB\u53D6\u7684\u3002\r\n     * \u6211\u4EEC\u77E5\u9053\uFF0C\u5728\u8C03\u7528\u526F\u4F5C\u7528\u51FD\u6570\u65F6\uFF0C\u4F1A\u628A\u81EA\u5DF1\u8D4B\u503C\u5230activeEffect\u53D8\u91CF\u53BB\uFF0C\u56E0\u6B64\u53EA\u8981\u5224\u65AD\u8FD9\u4E2A\u503C\u662F\u5426\u4E3A\u7A7A\u5373\u53EF\u3002\r\n     * \u4E0D\u662F\u88AB\u526F\u4F5C\u7528\u51FD\u6570\u8BFB\u53D6\u7684\uFF0C\u65E0\u9700\u8FDB\u884C\u4EFB\u4F55\u64CD\u4F5C\u3002\r\n     */\r\n    if (!activeEffect) return\r\n\r\n    // \u5148\u4ECEproxyObjectRecordMap\u4E2D\u53D6\u51FA\u5BF9\u5E94\u7684Proxy\u5BF9\u8C61\u7684\u8BB0\u5F55\r\n    let depsMap = proxyObjectRecordMap.get(target)\r\n    // \u5982\u679C\u8FD9\u4E2AProxy\u5BF9\u8C61\u8FD8\u6CA1\u6709\u88AB\u8BB0\u5F55\u8FC7\uFF0C\u90A3\u6211\u4EEC\u5148\u7ED9\u4ED6\u521B\u5EFA\u4E00\u4E2A\u7A7A\u7684\u5B58\u8FDB\u53BB\r\n    if (!depsMap) {\r\n        proxyObjectRecordMap.set(target, depsMap = new Map())\r\n    }\r\n\r\n    // \u518D\u4ECEProxy\u5BF9\u8C61\u8BB0\u5F55\u4E2D\u53D6\u51FA\u5BF9\u5E94\u5C5E\u6027\u503C\u7684\u8BB0\u5F55\r\n    let deps = depsMap.get(key)\r\n    // \u8BE5\u5C5E\u6027\u503C\u6CA1\u6709\u88AB\u8BB0\u5F55\u8FC7\u7684\u8BDD\uFF0C\u90A3\u7EE7\u7EED\u7ED9\u4ED6\u65B0\u5EFA\u4E00\u4E2A\r\n    if (!deps) {\r\n        depsMap.set(key, deps = new Set())\r\n    }\r\n\r\n    // \u628A\u8FD9\u6B21\u6240\u4F7F\u7528\u7684\u526F\u4F5C\u7528\u51FD\u6570\u5B58\u5230\u8BE5\u5C5E\u6027\u503C\u7684set\u6570\u7EC4\u53BB\u5373\u53EF\r\n    deps.add(activeEffect);\r\n    // console.log('\u8FFD\u52A0\u4F9D\u8D56', '\u4F9D\u8D56\u6570\u7EC4\uFF1A', deps, '\u76EE\u6807\u503C\uFF1A', target, '\u5C5E\u6027\u540D\uFF1A', key, 'Proxy\u5BF9\u8C61map\uFF1A', depsMap);\r\n\r\n}\r\n\r\n/**\r\n * \u89E6\u53D1\u5668\uFF1A\u5F53\u67D0\u4E2A\u5C5E\u6027\u503C\u88AB\u4FEE\u6539\u65F6\uFF0C\u4F1A\u89E6\u53D1\u4F9D\u8BA2\u9605\u8BE5\u5C5E\u6027\u503C\u7684\u526F\u4F5C\u7528\u51FD\u6570\u7684\u65B9\u6CD5\u3002\u89E6\u53D1\u5668\u4F1A\u5728handler\u7684set()\u65B9\u6CD5\u4E2D\u88AB\u8C03\u7528\u3002\r\n */\r\nexport function trigger(target: Object, key: String | Symbol | number) {\r\n    // \u540C\u7406\uFF0C\u5148\u4ECEproxyObjectRecordMap\u4E2D\u53D6\u51FA\u67D0\u4E2AProxy\u5BF9\u8C61\u7684\u8BB0\u5F55\r\n    const depsMap = proxyObjectRecordMap.get(target);\r\n    // console.log(depsMap, '\u53D6\u51FAproxyMap');\r\n\r\n    if (!depsMap) return;\r\n\r\n    // \u518D\u4ECEProxy\u5BF9\u8C61\u7684\u8BB0\u5F55\u4E2D\u53D6\u51FA\u67D0\u4E2A\u5C5E\u6027\u503C\u7684\u8BB0\u5F55\r\n    const deps = depsMap.get(key)\r\n    // console.log(deps,key, '\u53D6\u51FA\u5C5E\u6027\u503Cmap');\r\n\r\n    if (!deps) return\r\n\r\n\r\n    // \u904D\u5386\u8FD9\u4E2A\u6570\u7EC4\u7684\u51FD\u6570\u6267\u884C\u5373\u53EF\r\n    deps.forEach((effectFn: effectFn) => {\r\n\r\n        // \u5982\u679C\u6709\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\uFF0C\u90A3\u5C31\u6267\u884C\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\uFF08\u8BE6\u89C1Computed\uFF09\r\n        if (effectFn.scheduler) {\r\n            effectFn.scheduler()\r\n        } else {\r\n            // \u6CA1\u6709\u81EA\u5B9A\u4E49\u51FD\u6570\u5C31\u6267\u884C\u526F\u4F5C\u7528\u51FD\u6570\u672C\u8EAB\r\n            effectFn()\r\n        }\r\n    })\r\n}", "import { isObject, isArray, hasChange } from '@Biu/utils'\r\nimport { track, trigger } from './effect'\r\nimport {ProxyTarget} from './types'\r\n\r\nconst proxyMap = new WeakMap();\r\n\r\nexport function reactive(target: unknown): any {\r\n\r\n    // \u4F20\u5165\u7C7B\u578B\u975EObject\u7684\u8BDD\uFF0C\u76F4\u63A5\u8FD4\u56DE\u539F\u503C\r\n    if (!isObject(target)) return target\r\n\r\n    // \u5982\u679C\u4F20\u5165\u7684\u5DF2\u7ECF\u662F\u4E00\u4E2A\u7531Reactive\u751F\u6210\u7684Proxy\u5BF9\u8C61\uFF0C\u76F4\u63A5\u8FD4\u56DE\u539F\u503C\r\n    if (isProxy(target as Object)) return target\r\n\r\n    // \u5982\u679C\u4F20\u5165\u7684\u539F\u59CB\u5BF9\u8C61\u5DF2\u7ECF\u88ABReactive\u5904\u7406\u8FC7,\u8FD4\u56DE\u5BF9\u5E94\u7684Proxy\u5BF9\u8C61\r\n    if (proxyMap.has(target as Object)) return proxyMap.get(target as Object)\r\n\r\n    // \u521B\u5EFA\u4E00\u4E2A\u65B0\u7684Proxy\u5BF9\u8C61\r\n    const proxy = new Proxy(target as Object, {\r\n        get(target, key, receiver) {\r\n            // \u63D0\u4F9B\u7ED9isProxy\u51FD\u6570\u4F7F\u7528, \u5982\u679C\u8BFB\u53D6__isReactive\u8FD9\u4E2A\u5C5E\u6027, \u90A3\u5C31\u4E00\u5F8B\u8FD4\u56DEtrue, \u8BC1\u660E\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\r\n            if (key === '__isReactive') return true\r\n\r\n            // \u6536\u96C6\u8BA2\u9605\u672C\u5C5E\u6027\u7684\u526F\u4F5C\u7528\u51FD\u6570\r\n            track(target, key);\r\n\r\n            /**  \u5728Proxy\u4E2D\uFF0C\u5FC5\u987B\u4F7F\u7528Reflect\u54CD\u5E94\u5BF9\u5E94\u7684\u64CD\u4F5C\u3002\u5982\u679C\u76F4\u63A5return target[key]\u4F1A\u5BFC\u81F4\u8BA2\u9605\u8005\u4E22\u5931\u95EE\u9898\u3002\r\n             * \u6BD4\u65B9\u8BF4\u6211\u4EEC\u6709\u4E00\u4E2A\u5BF9\u8C61obj: { \r\n             *    name: 'angel', \r\n             *    get getUsername() {    //\u8FD9\u662F\u8BBF\u95EE\u5668\u5C5E\u6027\r\n             *        return this.name\r\n             *    } \r\n             *}\r\n             * \u7136\u540E\u6211\u4EEC\u5C06\u8FD9\u4E2A\u5BF9\u8C61obj\u8F6C\u5316\u6210Proxy\u5BF9\u8C61\uFF0C\u5728\u8BFB\u53D6getUsername\u5C5E\u6027\u65F6\uFF0Creturn target[key]\u8FD4\u56DE\u7684\u662F\u539F\u5BF9\u8C61\u4E0A\u7684name\u5C5E\u6027\uFF0C\u56E0\u6B64\u53EA\u6709getUsername\u5C5E\u6027\u4F1A\u88ABMap\u8BB0\u5F55\u4E0B\u6765\u3002\r\n             * Reflect\u7684receiver\u53C2\u6570\u7684\u610F\u4E49\u5728\u4E8E\u5C06this\u91CD\u65B0\u6307\u5411proxy\u5BF9\u8C61\u81EA\u8EAB\uFF0C\u8FD9\u6837\u5728\u8BFB\u53D6getUsername\u65F6\uFF0Cproxy\u5BF9\u8C61\u7684name\u5C5E\u6027\u4E5F\u88AB\u8BFB\u53D6\uFF0C\u4FDD\u8BC1\u6240\u6709\u5C5E\u6027\u90FD\u80FD\u88AB\u8BB0\u5F55\u3002\r\n             */\r\n            const res = Reflect.get(target, key, receiver)\r\n\r\n            /**\r\n             * \u8FD9\u91CC\u662FVue2\u4E0EVue3\u54CD\u5E94\u5F0F\u5B9E\u73B0\u7684\u4E00\u4E2A\u5173\u952E\u5DEE\u5F02,\u5F53\u9047\u5230\u6DF1\u5C42Object\u65F6,Vue2\u4F1A\u4E3B\u52A8\u9012\u5F52\u8FDB\u884CdefineProperty,\u8FDB\u884C\u6DF1\u5C42\u4EE3\u7406\r\n             * Vue3\u8FD9\u79CD\u505A\u6CD5\u53EF\u4EE5\u79F0\u4E3A\"\u61D2\u4EE3\u7406\",\u53EA\u6709\u771F\u6B63\u901A\u8FC7get\u8BFB\u53D6\u5230\u6DF1\u5C42\u7684Object\u65F6,\u624D\u53BB\u8FDB\u884CReactive\u9012\u5F52\u5904\u7406,\u8282\u7EA6\u4E86\u6027\u80FD\r\n             */\r\n            return isObject(res) ? reactive(res) : res\r\n        },\r\n        set<T extends Object | [], K extends keyof T>(target: T, key: K, value: any, receiver: any) {\r\n\r\n            // oldValue\u548ColdValue\u53D6\u503C\u9700\u8981\u653E\u5728\u524D\u9762,\u56E0\u4E3AReflect\u4E00\u65E6\u6267\u884C,\u5C31\u5DF2\u7ECF\u66F4\u6539\u4E86\u503C\r\n            const oldLength = isArray(target) ? (<[]>target).length : null\r\n            const oldValue = target[key]\r\n            const res = Reflect.set(target, key, value, receiver)\r\n\r\n            // \u5982\u679C\u65B0\u4FEE\u6539\u7684\u503C\u8DDF\u539F\u6765\u7684\u4E00\u6837,\u65E0\u9700\u6267\u884CTrigger\u64CD\u4F5C\r\n            if (hasChange(oldValue, target[key])) {\r\n\r\n                // \u5F53\u8FD9\u4E2A\u503C\u88AB\u6539\u53D8\u65F6\uFF0C\u901A\u77E5\u6240\u6709\u8BA2\u9605\u81EA\u8EAB\u7684\u526F\u4F5C\u7528\u51FD\u6570\u91CD\u65B0\u6267\u884C\u4E00\u6B21\r\n                trigger(target, key)\r\n                /** \r\n                 * \u5982\u679C\u76EE\u6807\u503C\u662F\u6570\u7EC4,\u8FD8\u9700\u8981\u5BF9\u4ED6\u7684length\u5C5E\u6027\u505A\u5355\u72EC\u7684\u54CD\u5E94\r\n                 * \u6211\u4EEC\u7684trigger\u662F\u6839\u636EProxy\u5BF9\u8C61\u7684\u5C5E\u6027\u540D\u8FDB\u884C\u54CD\u5E94\u7684\r\n                 * \u5982\u679C\u5BF9\u6570\u7EC4\u8FDB\u884Cpush\u7B49\u64CD\u4F5C, length\u9690\u6027\u6539\u53D8\u4E86, \u4F46\u56E0\u4E3A\u4E0D\u662F\u76F4\u63A5\u64CD\u4F5C\u5C5E\u6027\u540Dlength,\u65E0\u6CD5\u901A\u77E5\u5230\u5BF9\u5E94\u4F9D\u8D56\uFF0C\u9700\u8981\u624B\u52A8\u89E6\u53D1\r\n                 * */\r\n                if (isArray(target) && ((<[]>target).length !== oldLength)) {\r\n                    trigger(target, \"length\")\r\n                }\r\n            }\r\n            return res\r\n        }\r\n    })\r\n    // \u8BB0\u5F55\u8FD9\u4E2A\u539F\u59CB\u5BF9\u8C61\r\n    proxyMap.set(target as Object, proxy);\r\n    return proxy\r\n}\r\n\r\n\r\n/**\r\n * \u901A\u8FC7\u8BFB\u53D6\u88AB\u4EE3\u7406\u5BF9\u8C61\u4E0A__isReactive\u8FD9\u4E2A\u7279\u6B8A\u7684\u5C5E\u6027\u540D\uFF0C\u5224\u65AD\u662F\u5426\u5DF2\u7ECF\u662F\u88AB\u4EE3\u7406\u8FC7\r\n * \u5982\u679C\u662FVue2\u4E2D\uFF0C\u4F1A\u628A\u8FD9\u4E2A\u5C5E\u6027\u503C\u771F\u5B9E\u5730\u5199\u5165\u5230\u5BF9\u8C61\u4E0A\r\n * \u4F46\u6211\u4EEC\u62E6\u622A\u4E86get\u64CD\u4F5C\uFF0C\u5373\u4F7F\u4E0D\u5199\u5165\u5230\u5BF9\u8C61\u4E0A\uFF0C\u5728\u62E6\u622A\u5230\u8BE5\u5C5E\u6027\u8BFB\u53D6\u7684\u65F6\u5019\u8FD4\u56DEtrue\u5373\u53EF\r\n */\r\nexport function isProxy(target: ProxyTarget): Boolean {\r\n    return target && Boolean(target.__isReactive);\r\n}", "import { isObject, hasChange } from '@Biu/utils'\r\nimport { reactive } from './reactive';\r\nimport { track, trigger } from './effect'\r\nimport { Ref } from './types'\r\nexport function ref(target: unknown): Ref {\r\n    // \u5DF2\u7ECF\u662FRef\u540C\u6837\u8FD4\u56DE\u539F\u503C\r\n    if (isRef(target)) return (target as Ref);\r\n    return new RefImpl(target)\r\n}\r\n\r\nfunction isRef(target: any): Boolean {\r\n    return !!(target && target.__isRef)\r\n}\r\n\r\n/**\r\n * reactive\u65B9\u6CD5\u4F7F\u7528Proxy\u5BF9\u8C61\u5B9E\u73B0\uFF0C\u800Cref\u4F7F\u7528\u666E\u901A\u5BF9\u8C61\u5B9E\u73B0\r\n * \u672C\u8D28\u4E0A\u8DDFVue2\u7684defineProperty\u6CA1\u6709\u533A\u522B\uFF0C\u4F46\u4F7F\u7528\u4E86\u7C7B\u8FD9\u4E2A\u9762\u5411\u5BF9\u8C61\u6982\u5FF5\u8BED\u6CD5\r\n */\r\nclass RefImpl {\r\n    __isRef: boolean\r\n    __value: any\r\n    constructor(target: unknown) {\r\n        this.__isRef = true; // \u8FDB\u884C\u81EA\u6211\u6807\u8BB0\uFF0C\u63D0\u793A\u5DF2\u7ECF\u8FDB\u884CRef\u8F6C\u6362\r\n        this.__value = convert(target);\r\n    }\r\n    // \u7B49\u540C\u4E8E\u5BF9\u8C61\u7684\u8BBF\u95EE\u5668\u5C5E\u6027\uFF0C\u5305\u542B\u4E00\u4E2Aget\u51FD\u6570\u548C\u4E00\u4E2Aset\u51FD\u6570\uFF0C\u56E0\u4E3A\u5FC5\u987B\u8BBE\u7F6E\u5C5E\u6027\u540D\uFF0C\u6240\u4EE5vue3\u7684ref\u5FC5\u987B\u4F7F\u7528.value\u53D6\u503C\r\n    get value() {\r\n        // \u7EE7\u7EED\u4F7F\u7528Reactive\u7684\u8DDF\u8E2A\u5668\u548C\u89E6\u53D1\u5668\r\n        track(this, 'value')\r\n        return this.__value\r\n    }\r\n    set value(newValue) {\r\n        // \u4F9D\u7136\u522B\u5FD8\u4E86\u5224\u65AD\u662F\u5426\u66F4\u6539\r\n        if (hasChange(this.__value, newValue)) {\r\n            // \u6CE8\u610F\u5148\u8D4B\u503C\u518D\u89E6\u53D1\uFF0C\u800C\u4E14\u8981\u5957\u5728convert\u51FD\u6570\u91CC\uFF0C\u9632\u6B62\u4F20\u4E86\u4E2A\u65B0\u5BF9\u8C61\u8FC7\u6765\r\n            this.__value = convert(newValue)\r\n            trigger(this, 'value')\r\n        }\r\n    }\r\n}\r\n// \u5224\u65AD\u662F\u5426\u5BF9\u8C61\uFF0C\u662F\u7684\u8BDD\u4F7F\u7528reactive\u8FDB\u884C\u8F6C\u6362\r\nfunction convert(target: unknown) {\r\n    return isObject(convert) ? reactive(target) : target\r\n}", "/**\r\n * computed\u6700\u7EC8\u8FD4\u56DE\u503C\u662F\u4E00\u4E2ARef\uFF0C\u8FD9\u91CC\u4F7F\u7528\u7C7B\u6A21\u4EFF\u4E86Ref\u7684\u5199\u6CD5\uFF0C\u8FD9\u4E5F\u662Fcomputed\u53D6\u503C\u65F6\u4E5F\u9700\u8981.value\u7684\u539F\u56E0\r\n * computed\u5177\u6709\u7F13\u5B58\u673A\u5236\uFF0C\u4F9D\u8D56\u4E0D\u6539\u53D8\u7684\u8BDD\uFF0C\u4E0D\u4F1A\u91CD\u65B0\u8BA1\u7B97\u5C5E\u6027\r\n * \u800C\u4E14\u5177\u6709\u61D2\u66F4\u65B0\u7684\u7279\u6027\uFF0C\u4F9D\u8D56\u7684\u503C\u6539\u53D8\u4EE5\u540E\u4E0D\u4F1A\u7ACB\u5373\u89E6\u53D1\u8BA1\u7B97\uFF0C\u53EA\u6709\u5230\u771F\u6B63\u53D6\u503C\u7684\u65F6\u5019\u624D\u4F1A\u91CD\u65B0\u8BA1\u7B97\r\n */\r\nimport { effect, track, trigger } from './effect'\r\nimport { ComputedOptions } from './types'\r\nimport { isFunction } from '@Biu/utils'\r\n\r\nexport function computed(getterOrOptions: Function | ComputedOptions) {\r\n    let getter, setter\r\n    if (isFunction(getterOrOptions)) {\r\n        getter = <Function>getterOrOptions\r\n        setter = () => console.warn('Readonly Computed')\r\n    } else {\r\n        ({ get: getter = () => { }, set: setter = () => { } } = <ComputedOptions>getterOrOptions)\r\n    }\r\n    return new ComputedImpl(getter, setter)\r\n}\r\n\r\nclass ComputedImpl {\r\n    __value: any;\r\n    __dirty: Boolean; // \u810F\u503C\u68C0\u67E5\uFF0C\u5224\u65AD\u4F9D\u8D56\u662F\u5426\u5DF2\u7ECF\u66F4\u65B0\r\n    __effect: Function; // \u4E00\u4E2A\u7279\u6B8A\u7684effect\u51FD\u6570\uFF0C\u5E26\u6709\u61D2\u542F\u52A8+\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\u7684\u7279\u6027\r\n    __setter?: Function; // \u7528\u6237\u81EA\u5B9A\u4E49\u7684setter\u51FD\u6570\r\n    constructor(getter: Function, setter: Function) {\r\n        this.__dirty = true; // \u4F53\u73B0\u4E86\u61D2\u52A0\u8F7D\u7279\u6027\uFF0C\u521D\u59CB\u5316\u65F6\u4E0D\u76F4\u63A5\u6267\u884Ceffect\u51FD\u6570\u5E76\u4FDD\u5B58\u6700\u7EC8\u7684value\uFF0C\u800C\u662F\u505A\u4E00\u4E2A\u6807\u8BB0\uFF0C\u5728\u771F\u6B63\u88AB\u8BFB\u53D6\u65F6\u624D\u9996\u6B21\u8BA1\u7B97getter\u51FD\u6570\u7684\u8FD4\u56DE\u503C\r\n        setter && (this.__setter = setter) // \u5C06\u7528\u6237\u4F20\u5165\u7684setter\u5B58\u5230\u5B9E\u4F8B\u4E0B\r\n        this.__effect = effect(getter, {\r\n            lazy: true,\r\n            /**\r\n             *\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\uFF0C\u4F1A\u6302\u8F7D\u5230effectFn\u51FD\u6570\u8EAB\u4E0A\uFF0C\u5728trigger\u904D\u5386\u6267\u884C\u4F9D\u8D56\u7684\u526F\u4F5C\u7528\u51FD\u6570\u65F6\uFF0C\u5982\u679C\u53D1\u73B0effectFn\u51FD\u6570\u4E0B\u6709scheduler\uFF0C\u4F1A\u6267\u884Cscheduler\u800C\u4E0D\u662FeffectFn\u51FD\u6570\uFF08\u6B64\u5904\u4E3Agetter\u51FD\u6570\uFF09\r\n             *\u4F7F\u7528\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\u7684\u76EE\u7684\u4E3B\u8981\u662F\u5728set()\u51FD\u6570\u8C03\u7528trigger\u89E6\u53D1\u526F\u4F5C\u7528\u51FD\u6570\u65F6\uFF0C\u987A\u5E26\u628A\u7C7B\u7684dirty\u6807\u8BB0\u6539\u4E3Afalse\uFF0C\u5728\u4E0B\u6B21\u53D6\u503C\u65F6\u4F1A\u91CD\u65B0\u8BA1\u7B97\u503C   \r\n             * */\r\n            scheduler: () => {\r\n                if (!this.__dirty) {\r\n                    this.__dirty = true;\r\n                    /**\r\n                     * \u5F53getter\u4E2D\u4F9D\u8D56\u7684\u67D0\u4E2A\u5C5E\u6027\u503C\u88AB\u6539\u53D8\u65F6\uFF0C\u6211\u4EEC\u7684getter\u51FD\u6570\u4F5C\u4E3A\u5176\u4F9D\u8D56\uFF0C\u4F1A\u5728\u8BE5\u5C5E\u6027\u503C\u7684set\u51FD\u6570\u4E2D\u88ABtrigger\u89E6\u53D1\u3002\r\n                     * \u4F46\u56E0\u4E3A\u6211\u4EEC\u4F7F\u7528\u4E86\u81EA\u5B9A\u4E49\u8C03\u5EA6\u5668\uFF0C\u56E0\u6B64\u5E76\u4E0D\u6267\u884Cgetter\u51FD\u6570\uFF0C\u800C\u662F\u6267\u884C\u672C\u6BB5\u4EE3\u7801\u3002\r\n                     * \u6309\u7167Ref\u7684\u903B\u8F91\uFF0Ctrigger\u5E94\u8BE5\u5728\u81EA\u5DF1\u88ABset\u7684\u65F6\u5019\u901A\u77E5\u6267\u884C\u3002\u4F46\u8DDFRef\u4E0D\u540C\uFF0C\u6211\u4EEC\u5E76\u4E0D\u4FDD\u5B58\u81EA\u5DF1\u7684value\u503C\uFF0C\u800C\u53EA\u662F\u4FDD\u5B58\u4E00\u4E2Agetter\u51FD\u6570\u3002\u56E0\u6B64getter\u4F9D\u8D56\u7684\u503C\u901A\u77E5\u6211\u4EEC\u65F6\uFF0C\u6211\u4EEC\u4E5F\u9700\u8981\u901A\u77E5\u6240\u6709\u4F9D\u8D56\u4E8E\u6211\u4EEC\u7684\u526F\u4F5C\u7528\u51FD\u6570\u91CD\u65B0\u6267\u884C\u3002\r\n                     */\r\n                    trigger(this, 'value');\r\n                }\r\n            }\r\n        })\r\n    }\r\n    get value() {\r\n        // dirty\u6807\u8BB0\u4E3Atrue\uFF0C\u8BF4\u660E\u4F9D\u8D56\u5DF2\u66F4\u65B0\uFF0C\u9700\u8981\u91CD\u65B0\u8BA1\u7B97\u503C\r\n        if (this.__dirty) {\r\n            this.__dirty = false;\r\n            this.__value = this.__effect(); // effect\u51FD\u6570\u6700\u7EC8\u8FD4\u56DE\u503C\u662F\u4F20\u8FDB\u53BB\u7684\u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u6211\u4EEC\u4F20\u9012\u4E86getter\u8FDB\u53BB\uFF0C\u6240\u4EE5getter\u4F1A\u8FD4\u56DE\u6700\u65B0\u7684\u503C\u3002\uFF08\u987A\u5E26\u4F7F\u7528\u4E86effect\u53BB\u6536\u96C6\u4F9D\u8D56\uFF09\r\n            track(this, 'value') // \u6536\u96C6\u8BFB\u53D6\u672C\u8BA1\u7B97\u5C5E\u6027\u7684\u526F\u4F5C\u7528\u51FD\u6570\uFF08\u8DDF\u4E0A\u4E00\u884C\u4E0D\u540C\uFF0C\u4E0A\u4E00\u884C\u6536\u96C6\u7684\u662Fgetter\u51FD\u6570\u4E2D\u8BFB\u53D6\u503C\u7684\u4F9D\u8D56\uFF0C\u800C\u8FD9\u91CC\u5219\u662F\u6536\u96C6\u6211\u4EEC\u8BA1\u7B97\u51FD\u6570\u7684\u4F9D\u8D56\uFF09\r\n        }\r\n        return this.__value;\r\n    }\r\n    set value(newValue) {\r\n        this.__setter && this.__setter(newValue)\r\n    }\r\n}", "import { reactive } from './reactive'\r\nimport { ref } from './ref'\r\nimport { effect } from './effect'\r\nimport { computed } from './computed'\r\n\r\n\r\nconst tempWindow = window as any\r\nconst num = (tempWindow.b = ref(0))\r\n\r\n\r\ntempWindow.a = computed({\r\n    get() {\r\n        return num.value\r\n    },\r\n    set(newValue:any) {\r\n        console.log('\u4F60\u7684\u4E0B\u4E00\u53E5\u8BDD\u662F\uFF1A', newValue)\r\n        num.value = newValue\r\n    }\r\n})"],
  "mappings": "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",
  "names": []
}
